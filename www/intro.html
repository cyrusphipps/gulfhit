<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #e9f3ff;
      overflow: hidden;
    }
    canvas {
      display: block;
      cursor: default;
    }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const introAudio = new Audio("audio/animals/intro.mp3");
introAudio.loop = true;

function startIntroAudio() {
  const playPromise = introAudio.play();
  if (playPromise && typeof playPromise.catch === "function") {
    playPromise.catch(() => {
      document.addEventListener("click", startIntroAudio, { once: true });
      document.addEventListener("touchstart", startIntroAudio, { once: true });
    });
  }
}

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();
startIntroAudio();

/* =========================
   Play button hit area
========================= */
let playBtnBounds = null;

canvas.addEventListener("mousemove", e => {
  if (!playBtnBounds) return;
  const { x, y, w, h } = playBtnBounds;
  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left;
  const my = e.clientY - r.top;
  canvas.style.cursor =
    mx >= x && mx <= x + w && my >= y && my <= y + h
      ? "pointer"
      : "default";
});

canvas.addEventListener("click", e => {
  if (!playBtnBounds) return;
  const { x, y, w, h } = playBtnBounds;
  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left;
  const my = e.clientY - r.top;

  if (mx >= x && mx <= x + w && my >= y && my <= y + h) {
    introAudio.pause();
    introAudio.currentTime = 0;
    window.location.href = "animals.html";
  }
});

/* =========================
   Cards
========================= */
const CARD_W = 138;
const CARD_H = 184;
const CARD_RADIUS = 24;
const CARD_THICKNESS = 6;

const CARD_COUNT = 23;
const FLIP_COUNT = 6;

/* =========================
   Assets
========================= */
const animalImagePaths = [
  "img/animals/g1_bird_p1.webp",
  "img/animals/g1_cat_p1.webp",
  "img/animals/g1_dog_p1.webp",
  "img/animals/g1_fish_p1.webp",
  "img/animals/g1_horse_p1.webp",
  "img/animals/g1_spider_p1.webp",
  "img/animals/g2_bear_p1.webp",
  "img/animals/g2_bee_p1.webp",
  "img/animals/g2_dolphin_p1.webp",
  "img/animals/g2_duck_p1.webp",
  "img/animals/g2_frog_p1.webp",
  "img/animals/g2_lizard_p1.webp",
  "img/animals/g3_chicken_p1.webp",
  "img/animals/g3_ladybug_p1.webp",
  "img/animals/g3_lion_p1.webp",
  "img/animals/g3_monkey_p1.webp",
  "img/animals/g3_mouse_p1.webp",
  "img/animals/g3_panda_p1.webp",
  "img/animals/g4_cow_p1.webp",
  "img/animals/g4_elephant_p1.webp",
  "img/animals/g4_orca_p1.webp",
  "img/animals/g4_penguin_p1.webp",
  "img/animals/g4_rabbit_p1.webp"
];

function shuffleArray(items) {
  for (let i = items.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [items[i], items[j]] = [items[j], items[i]];
  }
  return items;
}

const shuffledAnimalImages = shuffleArray([...animalImagePaths]).slice(0, CARD_COUNT);
const cardImages = shuffledAnimalImages.map(src => {
  const img = new Image();
  img.src = src;
  return img;
});

const cards = [];
const directions = ["E","W","N","S"];
const backColors = ["#ffd166", "#06d6a0", "#ef476f", "#118ab2"];

const flipping = new Set();
while (flipping.size < FLIP_COUNT) {
  flipping.add(Math.floor(Math.random() * CARD_COUNT));
}

for (let i = 0; i < CARD_COUNT; i++) {
  const dir = directions[Math.floor(Math.random() * directions.length)];
  const speed = (30 + Math.random() * 20) * 1.1;

  cards.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: dir === "E" ? speed : dir === "W" ? -speed : 0,
    vy: dir === "S" ? speed : dir === "N" ? -speed : 0,
    rot: (Math.random() - 0.5) * 0.15,
    canFlip: flipping.has(i),
    flipPhase: Math.random() * Math.PI * 2,
    flipSpeed: 1.0 + Math.random() * 0.6,
    backColor: backColors[i % backColors.length],
    image: cardImages[i % cardImages.length]
  });
}

/* =========================
   Helpers
========================= */
function roundRect(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
}

function textHeight(text, font) {
  ctx.font = font;
  const m = ctx.measureText(text);
  return (m.actualBoundingBoxAscent || 0) +
         (m.actualBoundingBoxDescent || 0);
}

function fitFontSize(text, weight, baseSize, maxWidth, minSize = 32) {
  ctx.font = `${weight} ${baseSize}px 'Baloo 2'`;
  const width = ctx.measureText(text).width;
  if (width <= maxWidth) {
    return baseSize;
  }
  const scaled = Math.floor(baseSize * (maxWidth / width));
  return Math.max(minSize, scaled);
}

/* =========================
   Loop
========================= */
let last = performance.now();
let shimmerAngle = 0;

function loop(t) {
  const dt = (t - last) / 1000;
  last = t;
  shimmerAngle += dt * 1.2;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* =========================
     Cards
  ========================= */
  for (const c of cards) {
    c.x += c.vx * dt;
    c.y += c.vy * dt;

    if (c.x > canvas.width + CARD_W) c.x = -CARD_W;
    if (c.x < -CARD_W) c.x = canvas.width + CARD_W;
    if (c.y > canvas.height + CARD_H) c.y = -CARD_H;
    if (c.y < -CARD_H) c.y = canvas.height + CARD_H;

    const flip = c.canFlip
      ? Math.cos((c.flipPhase += dt * c.flipSpeed))
      : 1;

    ctx.save();
    ctx.translate(c.x + CARD_W / 2, c.y + CARD_H / 2);
    ctx.rotate(c.rot);

    if (Math.abs(flip) < 0.45) {
      ctx.fillStyle = "#ccc";
      ctx.fillRect(-CARD_THICKNESS/2, -CARD_H/2, CARD_THICKNESS, CARD_H);
    }

    ctx.scale(flip, 1);
    roundRect(-CARD_W/2, -CARD_H/2, CARD_W, CARD_H, CARD_RADIUS);
    ctx.clip();

    if (flip >= 0) {
      ctx.drawImage(c.image, -CARD_W/2, -CARD_H/2, CARD_W, CARD_H);
    } else {
      ctx.fillStyle = c.backColor;
      ctx.fillRect(-CARD_W/2, -CARD_H/2, CARD_W, CARD_H);
    }

    ctx.restore();
  }

  /* =========================
     Title Card
  ========================= */
  const isPortrait = canvas.height > canvas.width;
  const titlePaddingX = 25;
  const titlePaddingY = 25;
  const titleGap = Math.max(16, Math.min(34, canvas.height * 0.04));
  const titleMaxW = canvas.width * (isPortrait ? 0.9 : 0.62);
  const titleMaxTextW = titleMaxW - titlePaddingX * 2;

  const discoverySize = fitFontSize(
    "Discovery",
    800,
    Math.min(120, titleMaxW * 0.22),
    titleMaxTextW
  ) * 0.8;
  const animalsSize = fitFontSize(
    "Animals",
    800,
    Math.min(140, titleMaxW * 0.24),
    titleMaxTextW
  ) * 0.8;
  const discoveryFont = `800 ${discoverySize}px 'Baloo 2'`;
  const animalsFont = `800 ${animalsSize}px 'Baloo 2'`;

  const dH = textHeight("Discovery", discoveryFont);
  const aH = textHeight("Animals", animalsFont);
  const titleH = dH + aH + titleGap + titlePaddingY * 2;
  const titleW = titleMaxW;
  const titleX = (canvas.width - titleW) / 2;
  const titleY = Math.max(canvas.height * 0.08, titlePaddingY);

  ctx.fillStyle = "#2f3a5f";
  roundRect(titleX, titleY, titleW, titleH, 40);
  ctx.fill();

  ctx.strokeStyle = "rgba(255,255,255,0.25)";
  ctx.lineWidth = 4;
  roundRect(titleX + 6, titleY + 6, titleW - 12, titleH - 12, 34);
  ctx.stroke();

  /* =========================
     Title Text
  ========================= */
  const dy = titleY + titlePaddingY;
  const ay = dy + dH + titleGap;

  ctx.textAlign = "center";
  ctx.textBaseline = "top";

  ctx.fillStyle = "rgba(0,0,0,0.45)";
  ctx.font = discoveryFont;
  ctx.fillText("Discovery", canvas.width/2 + 4, dy + 6);
  ctx.font = animalsFont;
  ctx.fillText("Animals", canvas.width/2 + 4, ay + 6);

  ctx.fillStyle = "#fff";
  ctx.font = discoveryFont;
  ctx.fillText("Discovery", canvas.width/2, dy);
  ctx.font = animalsFont;
  ctx.fillText("Animals", canvas.width/2, ay);

  /* =========================
     Play Button
  ========================= */
  const footerText = "Early Jumpers Studios";
  const footerPadding = 15;
  const footerH = 26;
  const footerY = canvas.height - footerH - 15;

  ctx.font = "700 16px 'Baloo 2'";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  const footerTextW = ctx.measureText(footerText).width;
  const footerW = footerTextW + footerPadding * 2;
  const footerX = canvas.width / 2 - footerW / 2;

  const btnW = Math.min(280, canvas.width * 0.4);
  const btnH = 84;
  const btnX = canvas.width / 2 - btnW / 2;
  const defaultBtnY = titleY + titleH + 80;
  const maxBtnY = footerY - 10 - btnH;
  const btnY = Math.min(defaultBtnY, maxBtnY);

  playBtnBounds = { x: btnX, y: btnY, w: btnW, h: btnH };

  const baseGrad = ctx.createLinearGradient(btnX, btnY, btnX, btnY + btnH);
  baseGrad.addColorStop(0, "#fff");
  baseGrad.addColorStop(1, "#bbb");

  ctx.fillStyle = baseGrad;
  roundRect(btnX, btnY, btnW, btnH, 28);
  ctx.fill();

  const shimmerPos =
    (Math.cos(shimmerAngle) * 0.5 + 0.5) * (btnW + 160) - 80;

  const shimmerGrad = ctx.createLinearGradient(
    btnX + shimmerPos - 80, btnY,
    btnX + shimmerPos + 80, btnY + btnH
  );
  shimmerGrad.addColorStop(0, "rgba(255,255,255,0)");
  shimmerGrad.addColorStop(0.45, "rgba(255,255,255,0.95)");
  shimmerGrad.addColorStop(0.55, "rgba(255,255,255,0.95)");
  shimmerGrad.addColorStop(1, "rgba(255,255,255,0)");

  ctx.fillStyle = shimmerGrad;
  roundRect(btnX, btnY, btnW, btnH, 28);
  ctx.fill();

  // Play text explicitly centered
  ctx.fillStyle = "#333";
  ctx.font = "800 36px 'Baloo 2'";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("PLAY", canvas.width / 2, btnY + btnH / 2 + 5);

  /* =========================
     Footer
  ========================= */
  // set footer font/state explicitly (prevents weird carry-over)
  ctx.font = "700 16px 'Baloo 2'";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  ctx.fillStyle = "rgba(0,0,0,0.6)";
  roundRect(footerX, footerY, footerW, footerH, 10);
  ctx.fill();

  // âœ… moved DOWN by 3px (only change you wanted)
  ctx.fillStyle = "#f2f2f2";
  ctx.fillText(footerText, canvas.width / 2, footerY + footerH / 2 + 3);

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>

</body>
</html>
